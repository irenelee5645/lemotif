<!DOCTYPE html>
<html>
<head>
    <title>Lemotif: An Affective Visual Journal</title>
    <link href="{{ url_for('static', filename='stylesheet.css')}}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik&display=swap"
          rel="stylesheet">
    <script type="text/javascript">
        var emotionsDict = {
        {
            emotions | tojson
        }
        }
        ;
        var subjectsList = {
        {
            subjects | tojson
        }
        }
        ;
        var img_url = '/static/images/';
    </script>
</head>

<body>
<main>
    <div class="container">
        {% if demo %}
        <div id='input' class='demo'>
            <h1>Lemotif: An Affective Visual Journal</h1>
            <form method='post' id="inputs" action="{{ url_for('demo')}}">
                {% else %}
                <div id='input'>
                    <h1>Lemotif: An Affective Visual Journal</h1>
                    <form method='post' id="inputs" action="{{ url_for('home')}}">
                        {% endif %}
                        {% for n in range(n_inputs) %}
                        {% if n == 0 %}
                        <h3>What was the most salient part of your day? How did it make you feel?</h3>
                        {% else %}
                        <h3>Optional: What was another salient part of your day? How did it make you feel?</h3>
                        {% endif %}
                        <textarea id={{'text' ~ (loop.index0 + 1)}} name={{'text' ~ (loop.index0 + 1)}}
                                  placeholder='Write a little about something that happened today and how you felt.'>{{values['text' ~ (loop.index0 + 1)]}}</textarea>
                        {% endfor %}
                        <br><br>
                        <input type="submit" value=">> Generate Motifs" form="inputs">
                        {% if demo %}
                        <div class="instructions">
                        {% if completion_code %}
                            <p>Thank you for participating in our study! Please review the images to the right and note
                                the number of the version you like best. You may need to scroll down to see all six
                                styles. You will be asked for your favorite style later in this study.</p>
                            <p>After reviewing all images and choosing the style you like best, please return to your
                                AMT session and enter the following completion code: <strong>{{ completion_code }}</strong>
                            </p>
                            <p>You may now exit out of this window.</p>
                        {% else %}
                            <p>Welcome to our study. Please write a little bit about your day today (or yesterday)
                                in the boxes above. What were the most important things that happened and how did
                                they make you feel?
                            </p>
                            <p>Once you are done writing, click on the "Generate Motifs" button to see some visual
                                representations of your day. It may take a few seconds for the images to appear.</p>
                            <p>No user data is saved in this demo.</p>
                        {% endif %}
                        </div>
                        {% else %}
                        <h3 onclick="expand('settings')" class="toggle">Settings &#9662;</h3>
                        <div id="settings">
                            <div class="slider-container">
                                Lemotif Style<br>
                                {% for algorithm in ['carpet', 'circle', 'glass', 'tiles', 'string', 'watercolors'] %}
                                {% if settings['algorithm'] == algorithm %}
                                {% set check = 'checked' %}
                                {% else %}
                                {% set check = '' %}
                                {% endif %}
                                <input type="radio" id="algo_{{algorithm}}" name="algorithm" value="{{algorithm}}"
                                       {{check}}>
                                <label for="algo_{{algorithm}}">{{algorithm | capitalize}}</label>
                                {% endfor %}
                            </div>
                            <div class="slider-container">
                                <label for="icon_ratio">Icon Size: Percent of Canvas Size</label><br>
                                <input type="range" min="1" max="50" value={{(settings['icon_ratio']*100)|int}}
                                       class="slider" id="icon_ratio" name="icon_ratio"
                                       oninput="icon_ratio_out.value = icon_ratio.value + '%'">
                                <output name="icon_ratio_out" id="icon_ratio_out">
                                    {{(settings['icon_ratio']*100)|int}}%
                                </output>
                            </div>
                            <div class="slider-container">
                                <label for="size_flux">Icon Size Flux: Standard Deviation of Icon Resizing
                                    Factor</label><br>
                                <input type="range" min="0" max="100" value={{(settings['size_flux']*100)|int}}
                                       class="slider" id="size_flux" name="size_flux"
                                       oninput="size_flux_out.value = size_flux.value/100">
                                <output name="size_flux_out" id="size_flux_out">{{settings['size_flux']}}</output>
                            </div>
                            <div class="slider-container">
                                <label for="passes">Fill Density: Number of Passes Through Canvas</label><br>
                                <input type="range" min="1" max="20" value={{(settings['passes'])|int}}
                                       class="slider" id="passes" name="passes"
                                       oninput="passes_out.value = passes.value">
                                <output name="passes_out" id="passes_out">{{(settings['passes'])|int}}</output>
                            </div>
                            <div class="slider-container">
                                <label for="inc_floor">Min Icon Distance: Percent of Icon Size</label><br>
                                <input type="range" min="1" max="100" value={{(settings['inc_floor']*100)|int}}
                                       class="slider" id="inc_floor" name="inc_floor"
                                       oninput="inc_floor_out.value = inc_floor.value + '%'">
                                <output name="inc_floor_out" id="inc_floor_out">{{(settings['inc_floor']*100)|int}}%
                                </output>
                            </div>
                            <div class="slider-container">
                                <label for="inc_ceiling">Max Icon Distance: Percent of Icon Size</label><br>
                                <input type="range" min="1" max="100" value={{(settings['inc_ceiling']*100)|int}}
                                       class="slider" id="inc_ceiling" name="inc_ceiling"
                                       oninput="inc_ceiling_out.value = inc_ceiling.value + '%'">
                                <output name="inc_ceiling_out" id="inc_ceiling_out">
                                    {{(settings['inc_ceiling']*100)|int}}%
                                </output>
                            </div>
                            <div class="slider-container">
                                <label for="border_color">Border Color: Relative Intensity</label>
                                <input type="range" min="1" max="100" value={{(settings['border_color']*100)|int}}
                                       class="slider" id="border_color" name="border_color"
                                       oninput="border_color_out.value = border_color.value + '%'">
                                <output name="border_color_out" id="border_color_out">
                                    {{(settings['border_color']*100)|int}}%
                                </output>
                            </div>
                        </div>
                        <h3 onclick="expand('about')" class="toggle">About &#9662;</h3>
                        <div id="about"><p>
                            Lemotif is a project by <a href="mailto:xaliceli@gmail.com">Alice Li</a> &
                            <a href="mailto:deviparikh@gmail.com">Devi Parikh</a> building upon the ideas laid out in
                            <a href="https://arxiv.org/pdf/1903.07766.pdf">this paper</a>.
                            Our goal is to develop a fun, intuitive journalling tool helping users understand patterns
                            in
                            their emotional states and associated sources over time, thereby supporting emotional
                            well-being,
                            self-reflection, and opportunities for action.
                            (<a href="http://github.com/xaliceli/lemotif">Source Code</a>)
                        </p>
                            <p>This app represents a very early proof-of-concept demo. No user data is stored.</p>
                        </div>
                        {% endif %}
                    </form>
                </div>
                <div id='vis'>
                    {% if error %}
                    {{ error }}
                    {% endif %}
                    {% if images %}
                    {% if demo %}
                    <div id='motifs' class='demo'>
                        {% for style in ['Style 1', 'Style 2', 'Style 3', 'Style 4', 'Style 5', 'Style 6'] %}
                        {% set style_loop = loop %}
                        <h3><strong>{{ style }}</strong></h3>
                        {% for s in subj_labels %}
                        <div class="image-wrapper">
                            <img src='{{images[style_loop.index0 + (6 * loop.index0)]}}'><br>
                            <div class="image-label">
                                {{ s[0] }}
                                {% for emot in emot_labels[loop.index0] %}
                                <span style="background-color: hsl({{emotions[emot]['hsv'][0]}}, {{emotions[emot]['hsv'][1]}}%, 85%);
                                 color: hsl({{emotions[emot]['hsv'][0]}}, {{emotions[emot]['hsv'][1]}}%, 15%);
                                 padding: .1rem; margin: 0 .1rem;"> {{ emot }} </span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                        {% endfor %}
                        {% else %}
                        <div id='motifs'>
                            {% for image in images %}
                            <div class="image-wrapper">
                                <img src='{{image}}'><br>
                                <div class="image-label">
                                    {{ subj_labels[loop.index0][0]}}:
                                    {# {% set emotions_list = values['emotions' ~ (loop.index0)].split(', ') %} #}
                                    {% for emot in emot_labels[loop.index0] %}
                                    <span style="background-color: hsl({{emotions[emot]['hsv'][0]}}, {{emotions[emot]['hsv'][1]}}%, 85%);
                                 color: hsl({{emotions[emot]['hsv'][0]}}, {{emotions[emot]['hsv'][1]}}%, 15%);
                                 padding: .25rem; margin: 0 .5rem;"> {{ emot }} </span>
                                 {{ emot }}
                    </span>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </div>
</main>
<script src="{{ url_for('static', filename='jquery-3.4.1.min.js')}}"></script>
<script src="{{ url_for('static', filename='jquery-ui.min.js')}}"></script>
<script src="{{ url_for('static', filename='html2canvas.min.js')}}"></script>
<script src="{{ url_for('static', filename='script.js')}}"></script>
</body>
</html>